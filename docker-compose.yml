services:
  db:
    image: mariadb:latest
    container_name: aegis-db
    environment:
      - MYSQL_ROOT_PASSWORD=1234
      - MYSQL_DATABASE=aegis
      - TZ=Asia/Seoul
    volumes:
      - ./init:/docker-entrypoint-initdb.d
    ports:
      - "3306:3306"

  s3:
    image: minio/minio:latest              # MinIO 최신 버전 이미지 사용
    container_name: aegis-minio            # 컨테이너 이름
    environment:                           # 환경변수 설정
      - MINIO_ROOT_USER=admin              # 루트 사용자명
      - MINIO_ROOT_PASSWORD=12345678       # 루트 비밀번호 (8자 이상 필수)
      - TZ=Asia/Seoul                      # 시간대 설정
    command: server /data --console-address ":9001" # MinIO 서버 실행 명령
    ports:
      - "9000:9000"   # S3 API
      - "9001:9001"   # 웹 콘솔 UI

  backend:
    image: daehyuh/aegis-backend:latest      # Aegis 백엔드 이미지
    container_name: aegis-backend            # 컨테이너 이름
    env_file:                               
      - .env                                
    environment:
      - TZ=Asia/Seoul
    ports:
      - "8000:8000"                          # 백엔드 API 포트